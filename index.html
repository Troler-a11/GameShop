<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMESHOP | ELITE MARKET</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #05070a; }
        body { background: var(--bg); color: white; font-family: sans-serif; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .neon-btn { background: var(--neon); color: black; font-weight: 900; transition: 0.3s; }
        .neon-btn:hover { box-shadow: 0 0 20px rgba(0, 242, 255, 0.4); transform: scale(1.02); }
    </style>
</head>
<body class="pb-20">

    <nav class="sticky top-0 z-50 glass p-5 border-b border-white/5">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black italic tracking-tighter">GAME<span class="text-cyan-400">SHOP</span></h1>
            <div id="user-info" class="hidden flex items-center gap-3">
                <span id="user-display" class="text-[10px] font-bold uppercase tracking-widest text-slate-400"></span>
                <img id="user-img" class="w-8 h-8 rounded-full border border-cyan-500/50">
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-xs font-black uppercase tracking-[0.3em] text-cyan-400">Current Offers</h2>
            <button onclick="document.getElementById('add-modal').classList.remove('hidden')" class="text-[10px] bg-white/5 border border-white/10 px-4 py-2 rounded-full hover:bg-white/10">POST ITEM</button>
        </div>

        <div id="market-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
            </div>
    </main>

    <div id="auth-modal" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-6">
        <div class="glass max-w-sm w-full p-10 rounded-[2.5rem] text-center">
            <div id="auth-s1">
                <h3 class="text-2xl font-black mb-6 uppercase italic">Join GameShop</h3>
                <input type="text" id="reg-name" placeholder="Username" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl mb-4 outline-none focus:border-cyan-500">
                <input type="email" id="reg-email" placeholder="Email" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl mb-8 outline-none focus:border-cyan-500">
                <button onclick="sendOTP()" class="w-full neon-btn py-5 rounded-2xl uppercase text-[10px] tracking-widest">Request Code</button>
            </div>
            <div id="auth-s2" class="hidden">
                <h3 class="text-xl font-bold mb-4">VERIFY EMAIL</h3>
                <input type="text" id="otp-input" placeholder="000000S" class="w-full bg-black border-2 border-cyan-500 p-4 rounded-2xl text-center text-2xl font-mono mb-6">
                <button onclick="verifyCode()" class="w-full bg-white text-black font-black py-4 rounded-2xl uppercase text-[10px]">Verify Identity</button>
            </div>
        </div>
    </div>

    <div id="add-modal" class="hidden fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-6">
        <div class="glass max-w-md w-full p-8 rounded-3xl">
            <h3 class="text-xl font-black mb-6 uppercase">Post New Account</h3>
            <input type="text" id="p-title" placeholder="Account Title (e.g. 70/70 Brawlers)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-4 outline-none focus:border-cyan-400">
            <input type="number" id="p-price" placeholder="Price ($)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-4 outline-none focus:border-cyan-400">
            <input type="text" id="p-img" placeholder="Image Link (URL)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-6 outline-none focus:border-cyan-400">
            <div class="flex gap-4">
                <button onclick="saveItem()" class="flex-1 neon-btn py-4 rounded-xl text-xs uppercase">Confirm</button>
                <button onclick="document.getElementById('add-modal').classList.add('hidden')" class="flex-1 bg-white/5 py-4 rounded-xl text-xs uppercase">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // 1. ПІДКЛЮЧЕННЯ ДО ТВОЄЇ БАЗИ
        const firebaseConfig = {
            databaseURL: "https://gameshop-ff113-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const rtdb = firebase.database();

        // 2. EMAILJS
        emailjs.init("KErbU8_xE37eaf0qi");

        let currentOTP = "";
        let user = JSON.parse(localStorage.getItem('gs_user')) || null;

        function sendOTP() {
            const email = document.getElementById('reg-email').value;
            const name = document.getElementById('reg-name').value;
            if(!email.includes('@')) return alert("Enter valid email!");

            currentOTP = Math.floor(100000 + Math.random() * 900000) + "S";
            
            emailjs.send("default_service", "template_n90xvc9", {
                to_email: email,
                user_name: name,
                otp_code: currentOTP
            }).then(() => {
                document.getElementById('auth-s1').classList.add('hidden');
                document.getElementById('auth-s2').classList.remove('hidden');
            }).catch(() => {
                alert("EmailJS Mode: " + currentOTP);
                document.getElementById('auth-s1').classList.add('hidden');
                document.getElementById('auth-s2').classList.remove('hidden');
            });
        }

        function verifyCode() {
            if(document.getElementById('otp-input').value === currentOTP) {
                user = {
                    name: document.getElementById('reg-name').value,
                    email: document.getElementById('reg-email').value,
                    photo: `https://ui-avatars.com/api/?name=${document.getElementById('reg-name').value}&background=00f2ff&color=000`
                };
                localStorage.setItem('gs_user', JSON.stringify(user));
                location.reload();
            } else { alert("Wrong code!"); }
        }

        // 3. РОБОТА З ТОВАРАМИ
        function saveItem() {
            const title = document.getElementById('p-title').value;
            const price = document.getElementById('p-price').value;
            const img = document.getElementById('p-img').value;

            if(!title || !price || !img) return alert("Fill all fields!");

            const newItem = {
                title, price, img,
                seller: user.name,
                sellerImg: user.photo
            };

            rtdb.ref('market_items').push(newItem).then(() => {
                document.getElementById('add-modal').classList.add('hidden');
            });
        }

        function loadItems() {
            rtdb.ref('market_items').on('value', (snap) => {
                const data = snap.val();
                const grid = document.getElementById('market-grid');
                grid.innerHTML = '';
                for(let id in data) {
                    const item = data[id];
                    grid.innerHTML += `
                        <div class="glass p-5 rounded-[2rem] border border-white/5 hover:border-cyan-500/50 transition duration-500">
                            <img src="${item.img}" class="w-full h-40 object-cover rounded-2xl mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold uppercase italic text-sm">${item.title}</h4>
                                <span class="text-cyan-400 font-black">$${item.price}</span>
                            </div>
                            <div class="flex items-center gap-2 mb-4 opacity-50">
                                <img src="${item.sellerImg}" class="w-4 h-4 rounded-full">
                                <span class="text-[8px] font-bold uppercase tracking-widest">${item.seller}</span>
                            </div>
                            <button class="w-full bg-white text-black py-3 rounded-xl text-[10px] font-black uppercase hover:bg-cyan-400 transition">Buy Now</button>
                        </div>
                    `;
                }
            });
        }

        if(user) {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('user-display').innerText = user.name;
            document.getElementById('user-img').src = user.photo;
            loadItems();
        }
    </script>
</body>
</html>
