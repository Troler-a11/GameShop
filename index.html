<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTEM STORE | NEXUS INTERFACE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Inter:wght@100..900&family=JetBrains+Mono:wght@100..800&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-cyan: #00f2ff;
            --neon-blue: #3b82f6;
            --neon-purple: #8b5cf6;
            --deep-black: #020617;
            --surface-dark: #0f172a;
            --accent-gold: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        /* –ì–õ–û–ë–ê–õ–¨–ù–Ü –°–ö–õ–ê–î–ù–Ü –ê–ù–Ü–ú–ê–¶–Ü–á –î–õ–Ø –í–ê–ñ–õ–ò–í–û–°–¢–Ü */
        @keyframes cyber-pulse {
            0% { box-shadow: 0 0 5px rgba(0, 242, 255, 0.2); }
            50% { box-shadow: 0 0 20px rgba(0, 242, 255, 0.6); }
            100% { box-shadow: 0 0 5px rgba(0, 242, 255, 0.2); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes scan {
            from { top: -100%; }
            to { top: 100%; }
        }

        @keyframes text-glow {
            from { text-shadow: 0 0 2px #00f2ff; }
            to { text-shadow: 0 0 12px #00f2ff, 0 0 20px #3b82f6; }
        }

        /* –°–ö–õ–ê–î–ù–Ü –°–¢–ò–õ–Ü –ï–õ–ï–ú–ï–ù–¢–Ü–í */
        body {
            background: var(--deep-black);
            color: #f1f5f9;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .h-font { font-family: 'Orbitron', sans-serif; letter-spacing: 1px; }
        .m-font { font-family: 'JetBrains Mono', monospace; }

        .nexus-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 2.5rem;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nexus-card:hover {
            border-color: var(--neon-cyan);
            background: rgba(15, 23, 42, 0.9);
            transform: translateY(-5px) scale(1.01);
        }

        .cyber-btn {
            position: relative;
            overflow: hidden;
            background: var(--neon-cyan);
            color: #000;
            font-weight: 800;
            text-transform: uppercase;
            border-radius: 1.25rem;
            padding: 1.25rem;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .cyber-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            transition: 0.5s;
        }

        .cyber-btn:hover::before { left: 100%; }
        .cyber-btn:active { transform: scale(0.95); }

        .input-nexus {
            background: rgba(0, 0, 0, 0.4) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 1.25rem !important;
            padding: 1.1rem 1.5rem !important;
            color: #fff !important;
            width: 100%;
            outline: none !important;
            transition: 0.4s;
        }

        .input-nexus:focus {
            border-color: var(--neon-cyan) !important;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.15);
        }

        /* SCROLLBAR CUSTOMIZATION */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

        .status-online { width: 10px; height: 10px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981; }
        
        /* –ö–ê–¢–ï–ì–û–†–Ü–á –°–¢–ò–õ–Ü */
        .cat-chip {
            padding: 0.8rem 1.5rem;
            border-radius: 1rem;
            background: #0f172a;
            border: 1px solid #1e293b;
            color: #64748b;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            white-space: nowrap;
            transition: 0.3s;
        }

        .cat-chip.active {
            background: rgba(0, 242, 255, 0.1);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .badge-admin { background: linear-gradient(90deg, #ef4444, #8b5cf6); color: white; padding: 2px 8px; border-radius: 6px; font-size: 8px; font-weight: 900; }
    </style>
</head>
<body class="pb-32">

    <div id="auth-system" class="fixed inset-0 z-[99999] bg-slate-950 flex items-center justify-center p-4">
        <div class="absolute inset-0 overflow-hidden opacity-20 pointer-events-none">
            <div class="absolute top-0 left-0 w-full h-full" style="background: radial-gradient(circle at 50% 50%, #1e293b 0%, transparent 80%);"></div>
        </div>

        <div class="w-full max-w-md nexus-card p-10 md:p-14 relative z-10 animate-slide-up shadow-2xl">
            
            <div id="auth-reg-box" class="space-y-8">
                <div class="text-center space-y-2">
                    <h2 class="h-font text-4xl font-black text-white italic">ARTEM<span class="text-cyan-400">STORE</span></h2>
                    <p class="text-slate-500 text-[10px] uppercase tracking-[0.3em] font-bold">New User Protocol</p>
                </div>

                <div class="flex justify-center">
                    <input type="file" id="reg-p-file" class="hidden" accept="image/*">
                    <label for="reg-p-file" class="cursor-pointer group relative">
                        <div id="reg-p-preview" class="w-24 h-24 rounded-3xl border-2 border-dashed border-slate-800 flex items-center justify-center bg-black/50 group-hover:border-cyan-500 transition-all">
                            <span class="text-[8px] text-slate-600 font-black">AVATAR</span>
                        </div>
                    </label>
                </div>

                <div class="space-y-4">
                    <input type="text" id="reg-full-name" placeholder="Full Name" class="input-nexus">
                    <input type="text" id="reg-user-nick" placeholder="Username (English)" class="input-nexus">
                    <input type="email" id="reg-user-email" placeholder="E-mail" class="input-nexus">
                    <input type="password" id="reg-user-pass" placeholder="Password" class="input-nexus">
                </div>

                <button onclick="handleVerificationProcess()" class="w-full cyber-btn">Create Account</button>
                
                <div class="text-center">
                    <button onclick="toggleAuthMode('login')" class="text-slate-500 text-[10px] font-black uppercase tracking-widest hover:text-white transition">Sign In Instead</button>
                </div>
            </div>

            <div id="auth-login-box" class="hidden space-y-8">
                <div class="text-center">
                    <h2 class="h-font text-3xl text-white">WELCOME<span class="text-cyan-400">BACK</span></h2>
                    <p class="text-slate-500 text-[10px] mt-2 font-bold uppercase tracking-widest">Identify yourself</p>
                </div>

                <div class="space-y-4">
                    <input type="email" id="login-email" placeholder="Email" class="input-nexus">
                    <div class="relative">
                        <input type="password" id="login-pass" placeholder="Password" class="input-nexus">
                    </div>
                </div>

                <div class="flex flex-col gap-4">
                    <button onclick="processSystemLogin()" class="w-full cyber-btn">Authorize</button>
                    <button onclick="toggleAuthMode('forgot')" class="text-cyan-500/50 text-[9px] font-bold uppercase tracking-widest hover:text-cyan-400">Forgot Password?</button>
                </div>

                <div class="text-center pt-4">
                    <button onclick="toggleAuthMode('reg')" class="text-slate-500 text-[10px] font-black uppercase tracking-widest hover:text-white">Create New Identity</button>
                </div>
            </div>

            <div id="auth-forgot-box" class="hidden space-y-8">
                <div class="text-center">
                    <h2 class="h-font text-2xl text-white">RECOVER<span class="text-amber-500">KEY</span></h2>
                    <p class="text-slate-500 text-[9px] mt-2 font-bold uppercase tracking-widest">–ú–∏ –≤—ñ–¥–ø—Ä–∞–≤–∏–º–æ –∫–æ–¥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è</p>
                </div>
                <input type="email" id="forgot-email" placeholder="Enter your email" class="input-nexus">
                <button onclick="sendRecoveryCode()" class="w-full cyber-btn" style="background: #f59e0b;">Send Code</button>
                <button onclick="toggleAuthMode('login')" class="w-full text-slate-600 text-[10px] font-black uppercase">Back to login</button>
            </div>

            <div id="reg-step-2" class="hidden space-y-10 text-center">
                <h2 class="h-font text-2xl text-cyan-400">VERIFY CODE</h2>
                <input type="text" id="v-otp" maxlength="6" class="w-full bg-black border-2 border-cyan-500 p-5 rounded-2xl text-center text-4xl font-black text-cyan-400 tracking-widest outline-none">
                <button id="otp-confirm-btn" onclick="finalizeRegistration()" class="w-full cyber-btn">Confirm Access</button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-[1000] p-6 flex justify-between items-center bg-slate-950/80 backdrop-blur-xl border-b border-white/5">
        <div class="flex items-center gap-4" onclick="navigate('profile')">
            <div class="relative">
                <img id="user-p-avatar" class="w-12 h-12 rounded-2xl hidden object-cover border border-cyan-500/50 p-0.5">
                <div class="absolute -bottom-1 -right-1 status-online border-2 border-slate-950"></div>
            </div>
            <div>
                <h1 class="h-font text-lg font-black text-white italic">ARTEM<span class="text-cyan-400">STORE</span></h1>
                <div class="flex items-center gap-2">
                    <span class="text-[7px] text-slate-500 font-bold uppercase tracking-[0.2em]">Node: UA-77</span>
                    <span id="header-admin-tag" class="hidden badge-admin">ROOT</span>
                </div>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="openInboxSystem()" class="relative p-3.5 bg-slate-900 rounded-2xl border border-white/5">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
                <div id="notif-dot" class="hidden absolute top-3 right-3 w-2.5 h-2.5 bg-cyan-500 rounded-full border-2 border-slate-900 animate-pulse"></div>
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 md:p-10">
        <section id="page-shop" class="space-y-10">
            <div id="categories-bar" class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                <button onclick="filterByCategory('all')" class="cat-chip active" id="cat-all">All Items</button>
                </div>
            
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
        </section>

        <section id="page-admin" class="hidden max-w-2xl mx-auto py-10">
            <div class="nexus-card p-10 space-y-8">
                <div class="text-center space-y-2">
                    <h2 class="h-font text-2xl text-white uppercase">New Listing</h2>
                    <p class="text-slate-500 text-[10px] font-bold tracking-widest">DEPLOY PRODUCT TO DATABASE</p>
                </div>
                
                <div class="space-y-5">
                    <div class="grid grid-cols-2 gap-4">
                        <select id="p-new-game" class="input-nexus text-xs font-bold uppercase"></select>
                        <input type="number" id="p-new-price" placeholder="Price (USD)" class="input-nexus">
                    </div>
                    <input type="text" id="p-new-title" placeholder="Listing Title" class="input-nexus">
                    <textarea id="p-new-desc" placeholder="Full product description and details..." class="input-nexus h-32 resize-none"></textarea>
                    
                    <input type="file" id="p-new-img" class="hidden" accept="image/*">
                    <label for="p-new-img" id="img-label-preview" class="flex flex-col items-center justify-center p-12 border-2 border-dashed border-slate-800 rounded-[2rem] hover:border-cyan-500/50 cursor-pointer transition-all bg-black/20">
                        <svg class="w-8 h-8 text-slate-700 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                        <span class="text-[9px] text-slate-600 font-black uppercase">Attach Media File</span>
                    </label>
                </div>

                <button onclick="submitProductToFirebase()" class="w-full cyber-btn">Confirm Deployment</button>
            </div>
        </section>

        <section id="page-profile" class="hidden space-y-8">
            <div class="nexus-card p-12 text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 p-8">
                    <button onclick="systemSignOut()" class="text-red-500/30 hover:text-red-500 transition-all font-black text-[10px] uppercase">Terminal Exit</button>
                </div>

                <div class="relative inline-block mb-8">
                    <img id="p-view-avatar" class="w-36 h-36 rounded-[3rem] border-4 border-slate-900 object-cover shadow-2xl">
                    <div class="absolute -bottom-2 -right-2 bg-cyan-500 text-black px-4 py-1 rounded-full text-[10px] font-black italic">LEVEL 1</div>
                </div>

                <h2 id="p-view-name" class="h-font text-3xl font-black text-white italic"></h2>
                <p id="p-view-nick" class="m-font text-cyan-400 text-xs tracking-[0.4em] uppercase mt-2"></p>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-12">
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase mb-1">Total Sales</span>
                        <span class="text-2xl font-black text-white italic">0</span>
                    </div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase mb-1">Purchased</span>
                        <span class="text-2xl font-black text-white italic">0</span>
                    </div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase mb-1">Reputation</span>
                        <span class="text-2xl font-black text-amber-500 italic">5.0</span>
                    </div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase mb-1">Status</span>
                        <span class="text-2xl font-black text-cyan-400 italic">ACTIVE</span>
                    </div>
                </div>
            </div>

            <div class="max-w-xl mx-auto space-y-3">
                <button onclick="showMyLoves()" class="w-full flex items-center justify-between p-7 bg-slate-900/50 rounded-[2rem] border border-white/5 hover:border-cyan-500/30 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-pink-500/10 rounded-2xl flex items-center justify-center text-pink-500">‚ô•</div>
                        <span class="font-black text-[11px] uppercase tracking-widest text-slate-300">Favorite Items</span>
                    </div>
                    <span class="text-slate-700 font-mono text-xs">0</span>
                </button>
                
                <button onclick="filterMyProducts()" class="w-full flex items-center justify-between p-7 bg-slate-900/50 rounded-[2rem] border border-white/5 hover:border-cyan-500/30 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-cyan-500/10 rounded-2xl flex items-center justify-center text-cyan-400 italic">üì¶</div>
                        <span class="font-black text-[11px] uppercase tracking-widest text-slate-300">Active Listings</span>
                    </div>
                    <span id="my-lots-count" class="bg-cyan-500 text-black px-3 py-1 rounded-lg font-black text-[10px]">0</span>
                </button>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 inset-x-0 h-24 bg-slate-950/90 backdrop-blur-2xl border-t border-white/5 flex justify-around items-center z-[5000] px-6">
        <button onclick="navigate('shop')" id="nav-shop" class="flex flex-col items-center gap-1.5 opacity-100 transition-all">
            <svg class="w-7 h-7 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            <span class="text-[8px] font-black uppercase tracking-widest text-cyan-400">Market</span>
        </button>
        <button id="nav-btn-admin" onclick="navigate('admin')" class="hidden flex flex-col items-center gap-1.5 opacity-40 transition-all">
            <div class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center -mt-10 shadow-xl border-4 border-slate-950">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="3" d="M12 4v16m8-8H4"/></svg>
            </div>
            <span class="text-[8px] font-black uppercase tracking-widest">Deploy</span>
        </button>
        <button onclick="navigate('profile')" id="nav-profile" class="flex flex-col items-center gap-1.5 opacity-40 transition-all">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            <span class="text-[8px] font-black uppercase tracking-widest">Network</span>
        </button>
    </nav>
        <script>
        // --- –ü–ê–†–ê–ú–ï–¢–†–ò –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–á –¢–ê –ì–õ–û–ë–ê–õ–¨–ù–Ü –ö–û–ù–°–¢–ê–ù–¢–ò ---
        const DATABASE_URL = "https://gameshop-ff113-default-rtdb.firebaseio.com/";
        const EMAIL_JS_KEY = "KErbU8_xE37eaf0qi";
        const SERVICE_ID = "service_dbkrnz9";
        const RECOVERY_TEMPLATE = "template_n90xvc9"; // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–æ–π —Å–∞–º–∏–π –¥–ª—è OTP

        firebase.initializeApp({ databaseURL: DATABASE_URL });
        const DB = firebase.database();
        emailjs.init(EMAIL_JS_KEY);

        const GAME_LIST = ["Brawl Stars", "Standoff 2", "PUBG Mobile", "Roblox", "Steam", "Genshin Impact", "Free Fire", "Clash Royale"];
        const ROOT_USER = "ilemberk3356@gmail.com";

        // –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–µ–π—Ç –¥–æ–¥–∞—Ç–∫–∞
        let state = {
            user: JSON.parse(localStorage.getItem('artem_user_v5')) || null,
            otp: null,
            recovery_email: null,
            current_category: 'all',
            temp_img: null
        };

        // --- –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–Ü–ó–ê–¶–Ü–á –¢–ê –§–Ü–ö–°–£ –°–¢–ê–†–ò–• –ê–ö–ê–£–ù–¢–Ü–í ---
        function toggleAuthMode(mode) {
            const boxes = ['auth-reg-box', 'auth-login-box', 'auth-forgot-box', 'reg-step-2'];
            boxes.forEach(id => document.getElementById(id).classList.add('hidden'));
            
            if(mode === 'reg') document.getElementById('auth-reg-box').classList.remove('hidden');
            if(mode === 'login') document.getElementById('auth-login-box').classList.remove('hidden');
            if(mode === 'forgot') document.getElementById('auth-forgot-box').classList.remove('hidden');
        }

        async function processSystemLogin() {
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            const pass = document.getElementById('login-pass').value.trim();

            if(!email || !pass) return alert("–°–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–º–∏–ª–∫–∞: –ü–æ–ª—è –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏.");

            // –ü–æ—à—É–∫ –ø–æ –≤—Å—ñ–π –≥—ñ–ª—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
            const snapshot = await DB.ref('users').once('value');
            const users = snapshot.val();
            let found = null;

            if(users) {
                Object.values(users).forEach(u => {
                    if(u.email.toLowerCase() === email) found = u;
                });
            }

            if(!found) return alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ç–∞–∫–∏–º Email –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");

            // –§–Ü–ö–° –î–õ–Ø –¢–í–û–ì–û –ê–ö–ê–£–ù–¢–£ (—è–∫—â–æ –ø–∞—Ä–æ–ª—è —â–µ –Ω–µ–º–∞—î)
            if (!found.password) {
                if (confirm("–í–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –±–∞–∑—ñ, –∞–ª–µ –≤–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ü–µ–π –ø–∞—Ä–æ–ª—å —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π?")) {
                    await DB.ref('users/' + found.nick).update({ password: pass });
                    found.password = pass;
                    alert("–ü–∞—Ä–æ–ª—å —É—Å–ø—ñ—à–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –í—Ö–æ–¥–∂—É...");
                } else { return; }
            }

            if(found.password === pass) {
                localStorage.setItem('artem_user_v5', JSON.stringify(found));
                location.reload();
            } else {
                alert("–î–æ—Å—Ç—É–ø –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ: –ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å.");
            }
        }

        // --- –í–Ü–î–ù–û–í–õ–ï–ù–ù–Ø –ü–ê–†–û–õ–Ø ---
        async function sendRecoveryCode() {
            const email = document.getElementById('forgot-email').value.trim();
            if(!email) return alert("–í–≤–µ–¥—ñ—Ç—å –ø–æ—à—Ç—É!");

            state.recovery_email = email;
            state.otp = Math.floor(100000 + Math.random() * 900000).toString();

            emailjs.send(SERVICE_ID, RECOVERY_TEMPLATE, {
                to_email: email,
                otp_code: state.otp
            }).then(() => {
                alert("–ö–æ–¥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –ø–æ—à—Ç—É!");
                toggleAuthMode('otp');
                document.getElementById('reg-step-2').classList.remove('hidden');
                document.getElementById('otp-confirm-btn').onclick = finalizeRecovery;
            });
        }

        async function finalizeRecovery() {
            const code = document.getElementById('v-otp').value;
            if(code !== state.otp) return alert("–ö–æ–¥ –Ω–µ–≤—ñ—Ä–Ω–∏–π!");

            const newPass = prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å:");
            if(newPass && newPass.length > 3) {
                const snapshot = await DB.ref('users').once('value');
                const users = snapshot.val();
                let nick = null;
                Object.values(users).forEach(u => { if(u.email === state.recovery_email) nick = u.nick; });

                if(nick) {
                    await DB.ref('users/' + nick).update({ password: newPass });
                    alert("–ü–∞—Ä–æ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å.");
                    location.reload();
                }
            }
        }

        // --- –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–° –¢–ê –§–Ü–õ–¨–¢–†–ò ---
        function filterByCategory(cat) {
            state.current_category = cat;
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            renderMarketItems();
        }

        function renderMarketItems() {
            DB.ref('products').on('value', (snap) => {
                const grid = document.getElementById('product-grid');
                grid.innerHTML = '';
                const data = snap.val();
                if(!data) return;

                Object.keys(data).reverse().forEach(id => {
                    const item = data[id];
                    if(state.current_category !== 'all' && item.game !== state.current_category) return;

                    const isOwner = state.user && item.seller_nick === state.user.nick;
                    
                    grid.innerHTML += `
                        <div class="nexus-card p-6 flex flex-col h-full">
                            <div class="relative mb-5 group">
                                <img src="${item.img}" class="w-full h-48 object-cover rounded-3xl">
                                ${isOwner ? `
                                    <button onclick="deleteMyProduct('${id}')" class="absolute top-3 right-3 bg-red-500 p-2 rounded-xl hover:scale-110 transition shadow-xl">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                    </button>
                                ` : ''}
                            </div>
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-[8px] font-black text-cyan-400 border border-cyan-400/30 px-3 py-1 rounded-lg uppercase">${item.game}</span>
                                <span class="text-xl font-black text-white italic">$${item.price}</span>
                            </div>
                            <h3 class="text-white font-bold text-sm mb-2 truncate">${item.title}</h3>
                            <p class="text-slate-500 text-[10px] line-clamp-2 mb-6 flex-grow">${item.desc}</p>
                            
                            <div class="flex items-center justify-between pt-4 border-t border-white/5">
                                <div class="flex items-center gap-2">
                                    <img src="${item.seller_avatar}" class="w-6 h-6 rounded-lg object-cover">
                                    <span class="text-[9px] text-slate-400 font-bold">@${item.seller_nick}</span>
                                </div>
                                <button class="bg-white/5 hover:bg-cyan-500 hover:text-black p-3 rounded-xl transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" stroke-width="2" stroke-linecap="round"/></svg>
                                </button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        async function deleteMyProduct(id) {
            if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä –Ω–∞–∑–∞–≤–∂–¥–∏?")) {
                await DB.ref('products/' + id).remove();
                alert("–¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –±–∞–∑–∏.");
            }
        }

        // --- –î–û–î–ê–¢–ö–û–í–Ü –§–£–ù–ö–¶–Ü–á ---
        function navigate(target) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`page-${target}`).classList.remove('hidden');
            
            // UI Update –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
            document.querySelectorAll('nav button').forEach(b => b.classList.add('opacity-40'));
            document.getElementById(`nav-${target === 'admin' ? 'shop' : target}`).classList.remove('opacity-40');
        }

        function systemSignOut() {
            localStorage.removeItem('artem_user_v5');
            location.reload();
        }

        // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
        window.onload = () => {
            if(state.user) {
                document.getElementById('auth-system').classList.add('hidden');
                document.getElementById('user-p-avatar').src = state.user.avatar;
                document.getElementById('user-p-avatar').classList.remove('hidden');
                document.getElementById('p-view-avatar').src = state.user.avatar;
                document.getElementById('p-view-name').innerText = state.user.name;
                document.getElementById('p-view-nick').innerText = "@" + state.user.nick;
                
                if(state.user.email === ROOT_USER) {
                    document.getElementById('nav-btn-admin').classList.remove('hidden');
                    document.getElementById('header-admin-tag').classList.remove('hidden');
                }

                renderMarketItems();
            }

            // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
            const catBar = document.getElementById('categories-bar');
            const selectGame = document.getElementById('p-new-game');
            GAME_LIST.forEach(game => {
                catBar.innerHTML += `<button onclick="filterByCategory('${game}')" class="cat-chip">${game}</button>`;
                selectGame.innerHTML += `<option value="${game}">${game}</option>`;
            });
        };

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç—É
        document.getElementById('p-new-img').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = () => {
                state.temp_img = reader.result;
                document.getElementById('img-label-preview').innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover rounded-[1.5rem]">`;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        async function submitProductToFirebase() {
            if(!state.temp_img) return alert("–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä—É!");
            const title = document.getElementById('p-new-title').value;
            const price = document.getElementById('p-new-price').value;
            const desc = document.getElementById('p-new-desc').value;
            const game = document.getElementById('p-new-game').value;

            if(!title || !price) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ —Ü—ñ–Ω—É!");

            const newRef = DB.ref('products').push();
            await newRef.set({
                game, title, price, desc,
                img: state.temp_img,
                seller_nick: state.user.nick,
                seller_avatar: state.user.avatar,
                timestamp: Date.now()
            });

            alert("–¢–û–í–ê–† –û–ü–£–ë–õ–Ü–ö–û–í–ê–ù–û!");
            navigate('shop');
        }
    </script>
</body>
</html>
