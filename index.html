<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTEM STORE | GLOBAL CYBER MARKET 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,400&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --cyan: #00f2ff;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --dark-bg: #020617;
            --card-bg: #0f172a;
            --border-color: #1e293b;
            --success: #10b981;
            --error: #ef4444;
            --gold: #f59e0b;
        }

        /* –ö–†–£–¢–Ü –ê–ù–Ü–ú–ê–¶–Ü–á –î–õ–Ø –û–ë'–Ñ–ú–£ */
        @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        @keyframes pulse-cyan { 0%, 100% { box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); } 50% { box-shadow: 0 0 25px rgba(0, 242, 255, 0.5); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes rotate-border { 0% { border-color: var(--border-color); } 50% { border-color: var(--cyan); } 100% { border-color: var(--border-color); } }

        .animate-slide-up { animation: slide-up 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        .cyber-border-anim { animation: rotate-border 3s infinite linear; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; font-variant-numeric: tabular-nums; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: #e2e8f0;
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
        }

        .h-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--border-color);
        }

        .premium-card {
            background: linear-gradient(165deg, #111827 0%, #020617 100%);
            border: 1px solid var(--border-color);
            border-radius: 32px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .premium-card:hover {
            transform: translateY(-12px);
            border-color: var(--cyan);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }

        .cyber-input {
            background: #000000 !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 20px !important;
            padding: 18px 24px !important;
            color: #ffffff !important;
            transition: 0.3s;
            width: 100%;
            outline: none;
            font-size: 15px;
        }

        .cyber-input:focus {
            border-color: var(--cyan) !important;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
        }

        .btn-neon {
            background: var(--cyan);
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 22px;
            padding: 20px;
            transition: 0.4s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 8px 20px rgba(0, 242, 255, 0.3);
        }

        .btn-neon:active { transform: scale(0.94); }

        .bubble-me { background: linear-gradient(135deg, var(--cyan), var(--blue)); color: #000; border-radius: 24px 24px 4px 24px; }
        .bubble-them { background: #1e293b; color: #fff; border-radius: 24px 24px 24px 4px; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="pb-32">

    <div id="auth-system" class="fixed inset-0 z-[99999] bg-slate-950 flex items-center justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-lg bg-slate-900 border border-slate-800 p-8 md:p-12 rounded-[3.5rem] shadow-2xl animate-slide-up my-auto">
            
            <div id="auth-reg-box" class="space-y-8">
                <div class="text-center">
                    <div class="inline-block px-4 py-1 rounded-full bg-cyan-500/10 text-cyan-400 text-[10px] font-black tracking-[0.4em] mb-4 uppercase">Neural Registration</div>
                    <h2 class="h-font text-3xl text-white font-black">ARTEM<span class="text-cyan-400">STORE</span></h2>
                    <p class="text-slate-500 text-xs mt-3">–°—Ç–≤–æ—Ä–∏ —Å–≤—ñ–π —Ü–∏—Ñ—Ä–æ–≤–∏–π –≤—ñ–¥–±–∏—Ç–æ–∫ —É —Å–∏—Å—Ç–µ–º—ñ</p>
                </div>

                <div class="flex flex-col items-center gap-6">
                    <input type="file" id="reg-p-file" class="hidden" accept="image/*">
                    <label for="reg-p-file" class="cursor-pointer group">
                        <div id="reg-p-preview" class="w-28 h-28 rounded-[2.5rem] border-2 border-dashed border-slate-700 flex items-center justify-center bg-black overflow-hidden group-hover:border-cyan-500 transition-all duration-500">
                            <div class="text-center">
                                <span class="text-[9px] text-slate-600 font-black group-hover:text-cyan-400">UPLOAD PHOTO</span>
                            </div>
                        </div>
                    </label>
                </div>

                <div class="space-y-4">
                    <input type="text" id="reg-full-name" placeholder="–í–∞—à–µ —ñ–º'—è" class="cyber-input">
                    <input type="text" id="reg-user-nick" placeholder="Username (–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é)" class="cyber-input">
                    <input type="email" id="reg-user-email" placeholder="Email Address" class="cyber-input">
                    <input type="password" id="reg-user-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" class="cyber-input">
                </div>

                <button onclick="handleVerificationProcess()" class="w-full btn-neon">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
                
                <div class="text-center pt-4">
                    <p class="text-slate-500 text-[11px] uppercase font-bold">–í–∂–µ –º–∞—î—à –∞–∫–∞—É–Ω—Ç?</p>
                    <button onclick="toggleAuthMode('login')" class="text-cyan-400 text-xs font-black mt-2 underline tracking-widest">–£–í–Ü–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
                </div>
            </div>

            <div id="auth-login-box" class="hidden space-y-10">
                <div class="text-center">
                    <h2 class="h-font text-3xl text-white">LOGIN<span class="text-cyan-400">CORE</span></h2>
                    <p class="text-slate-500 text-xs mt-3 uppercase">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –ø–æ—à—Ç—É —Ç–∞ –ø–∞—Ä–æ–ª—å</p>
                </div>

                <div class="space-y-5">
                    <input type="email" id="login-email" placeholder="–í–∞—à–∞ –ø–æ—à—Ç–∞" class="cyber-input">
                    <input type="password" id="login-pass" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" class="cyber-input">
                </div>

                <button onclick="processSystemLogin()" class="w-full btn-neon">–ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è</button>

                <div class="text-center pt-4">
                    <button onclick="toggleAuthMode('reg')" class="text-slate-500 text-[10px] font-black uppercase tracking-widest hover:text-white">–ù–∞–∑–∞–¥ –¥–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</button>
                </div>
            </div>

            <div id="reg-step-2" class="hidden space-y-10 text-center animate-slide-up">
                <div>
                    <h2 class="h-font text-3xl text-white italic">CONFIRM</h2>
                    <p class="text-slate-400 text-xs mt-3">–í–≤–µ–¥—ñ—Ç—å 6-–∑–Ω–∞—á–Ω–∏–π –∫–æ–¥ –∑ –≤–∞—à–æ—ó –ø–æ—à—Ç–∏</p>
                </div>
                <input type="text" id="v-otp" maxlength="6" class="w-full bg-black border-2 border-cyan-500 p-6 rounded-3xl text-center text-5xl font-black text-cyan-400 tracking-[0.4em] outline-none">
                <button onclick="finalizeRegistration()" class="w-full btn-neon" style="background: #fff; color: #000;">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-[1000] glass-panel px-6 py-5 flex justify-between items-center border-b border-slate-800">
        <div class="flex items-center gap-4" onclick="navigate('profile')">
            <div class="relative">
                <img id="user-p-avatar" class="w-12 h-12 rounded-2xl hidden object-cover border-2 border-cyan-500">
                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-slate-900"></div>
            </div>
            <div>
                <h1 class="h-font text-xl font-black text-white italic">ARTEM<span class="text-cyan-400">STORE</span></h1>
                <p class="text-[8px] text-slate-600 font-bold uppercase tracking-widest">Global Marketplace 2026</p>
            </div>
        </div>
        <button onclick="openInboxSystem()" class="p-4 bg-slate-900/80 rounded-2xl border border-slate-800">
            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
        </button>
    </header>

    <main class="max-w-6xl mx-auto p-5 md:p-8">
        <section id="page-shop" class="space-y-12 animate-slide-up">
            <div id="categories" class="flex gap-4 overflow-x-auto no-scrollbar py-2"></div>
            <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        </section>

        <section id="page-admin" class="hidden max-w-2xl mx-auto space-y-10 animate-slide-up">
            <div class="text-center">
                <h2 class="h-font text-3xl text-cyan-400 uppercase">New Listing</h2>
                <p class="text-slate-500 text-xs mt-2 font-bold tracking-widest">–í–ò–°–¢–ê–í–¢–ï –°–í–Ü–ô –¢–û–í–ê–† –ù–ê –ü–†–û–î–ê–ñ</p>
            </div>
            <div class="bg-slate-900/50 p-10 rounded-[3.5rem] border border-slate-800 space-y-8">
                <select id="p-new-game" class="cyber-input"></select>
                <input type="text" id="p-new-title" placeholder="–ù–∞–∑–≤–∞ –≤–∞—à–æ—ó –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó..." class="cyber-input">
                <input type="number" id="p-new-price" placeholder="–¶—ñ–Ω–∞ –≤ USD" class="cyber-input">
                <textarea id="p-new-desc" placeholder="–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É..." class="cyber-input h-40"></textarea>
                <input type="file" id="p-new-img" class="hidden" accept="image/*">
                <label for="p-new-img" class="flex flex-col items-center justify-center p-12 border-2 border-dashed border-slate-800 rounded-3xl hover:border-cyan-500 cursor-pointer">
                    <span class="text-[10px] text-slate-500 font-black">–ó–ê–í–ê–ù–¢–ê–ñ–ò–¢–ò –°–ö–†–Ü–ù–®–û–¢</span>
                </label>
                <button onclick="submitProductToFirebase()" class="w-full btn-neon">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –Ω–∞ —Ä–∏–Ω–∫—É</button>
            </div>
        </section>

        <section id="page-profile" class="hidden space-y-10 animate-slide-up">
            <div class="bg-gradient-to-br from-slate-900 to-black p-12 rounded-[4rem] border border-slate-800 text-center shadow-2xl relative overflow-hidden">
                <img id="p-view-avatar" class="w-40 h-40 rounded-[3.5rem] border-4 border-cyan-500 mx-auto object-cover mb-8 shadow-2xl">
                <h2 id="p-view-name" class="h-font text-4xl font-black text-white italic"></h2>
                <p id="p-view-nick" class="text-cyan-400 font-mono tracking-[0.4em] uppercase text-xs mt-3"></p>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-12">
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-slate-800"><p class="text-[9px] text-slate-600 font-black uppercase">–ü–†–û–î–ê–ù–û</p><span class="text-2xl font-black text-white">0</span></div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-slate-800"><p class="text-[9px] text-slate-600 font-black uppercase">–ö–£–ü–õ–ï–ù–û</p><span class="text-2xl font-black text-white">0</span></div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-slate-800"><p class="text-[9px] text-slate-600 font-black uppercase">–†–ï–ô–¢–ò–ù–ì</p><span class="text-2xl font-black text-gold">5.0</span></div>
                    <div class="bg-black/40 p-6 rounded-[2rem] border border-slate-800"><p class="text-[9px] text-slate-600 font-black uppercase">STATUS</p><span class="text-2xl font-black text-cyan-400">PRO</span></div>
                </div>
            </div>

            <div class="max-w-xl mx-auto space-y-4">
                <button onclick="filterMyProducts()" class="w-full flex items-center justify-between p-8 bg-slate-900/50 rounded-[2.5rem] border border-slate-800 hover:border-cyan-500 transition-all">
                    <div class="flex items-center gap-5">
                        <span class="text-2xl">üì¶</span>
                        <span class="font-black text-sm uppercase tracking-widest">–ú–æ—ó –∞–∫—Ç–∏–≤–Ω—ñ –ª–æ—Ç–∏</span>
                    </div>
                    <span id="my-lots-count" class="bg-cyan-500 text-black px-4 py-1 rounded-xl font-black">0</span>
                </button>
                <button onclick="systemSignOut()" class="w-full p-10 text-red-500 font-black text-[10px] uppercase tracking-[0.6em] opacity-40 hover:opacity-100 transition-all">Logout from Database</button>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 inset-x-0 h-28 glass-panel border-t border-slate-800 flex justify-around items-center z-[5000] px-8">
        <button onclick="navigate('shop')" class="flex flex-col items-center gap-2"><svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg><span class="text-[9px] font-black uppercase tracking-widest text-cyan-400">Shop</span></button>
        <button id="nav-btn-admin" onclick="navigate('admin')" class="hidden flex flex-col items-center gap-2"><svg class="w-8 h-8 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg><span class="text-[9px] font-black uppercase tracking-widest text-slate-600">Sell</span></button>
        <button onclick="navigate('profile')" class="flex flex-col items-center gap-2"><svg class="w-8 h-8 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg><span class="text-[9px] font-black uppercase tracking-widest text-slate-600">User</span></button>
    </nav>

    <div id="system-chat" class="hidden fixed inset-0 z-[10000] bg-black flex flex-col">
        <header class="p-8 border-b border-slate-900 glass-panel flex items-center gap-6">
            <button onclick="closeModal('system-chat')" class="text-cyan-400 text-3xl">‚Üê</button>
            <img id="chat-partner-av" class="w-14 h-14 rounded-2xl object-cover">
            <div>
                <span id="chat-partner-nick" class="font-black text-white block"></span>
                <span class="text-[9px] text-cyan-500 uppercase tracking-widest animate-pulse">Connection: Secure</span>
            </div>
        </header>
        <div id="chat-messages-container" class="flex-1 overflow-y-auto p-8 flex flex-col gap-6 no-scrollbar"></div>
        <footer class="p-8 glass-panel flex gap-4">
            <input type="text" id="chat-input-field" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." class="flex-1 cyber-input">
            <button onclick="processMessageSend()" class="p-6 bg-cyan-500 text-black rounded-2xl font-black">‚û§</button>
        </footer>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const FIRE_CONFIG = { databaseURL: "https://gameshop-ff113-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(FIRE_CONFIG);
        const DB_LAYER = firebase.database();
        emailjs.init("KErbU8_xE37eaf0qi");

        const CATEGORIES_MASTER = ["Brawl Stars", "Standoff 2", "PUBG Mobile", "Roblox", "Steam", "Genshin Impact", "Free Fire", "Clash Royale"];
        const SUPER_ADMIN = "ilemberk3356@gmail.com";

        let app_state = {
            current_user: JSON.parse(localStorage.getItem('artem_user_v4')) || null,
            otp_code: null,
            temp_avatar_buffer: null,
            active_chat_partner: null
        };

        // --- AUTH LOGIC (LOGIN + REG) ---
        function toggleAuthMode(mode) {
            document.getElementById('auth-reg-box').classList.toggle('hidden', mode === 'login');
            document.getElementById('auth-login-box').classList.toggle('hidden', mode === 'reg');
        }

        async function processSystemLogin() {
            const email = document.getElementById('login-email').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            if(!email || !pass) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ—à—Ç—É —Ç–∞ –ø–∞—Ä–æ–ª—å!");

            // –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –±–∞–∑—ñ –ø–æ –ø–æ—à—Ç—ñ
            const users_snap = await DB_LAYER.ref('users').get();
            const users_data = users_snap.val();
            
            let found_user = null;
            if(users_data) {
                Object.values(users_data).forEach(u => {
                    if(u.email === email && u.password === pass) found_user = u;
                });
            }

            if(found_user) {
                localStorage.setItem('artem_user_v4', JSON.stringify(found_user));
                location.reload();
            } else {
                alert("–ü–æ–º–∏–ª–∫–∞: –ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –∞–±–æ –∞–∫–∞—É–Ω—Ç –Ω–µ —ñ—Å–Ω—É—î!");
            }
        }

        document.getElementById('reg-p-file').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = () => {
                app_state.temp_avatar_buffer = reader.result;
                document.getElementById('reg-p-preview').innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover">`;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        async function handleVerificationProcess() {
            const name = document.getElementById('reg-full-name').value;
            const nick = document.getElementById('reg-user-nick').value.trim();
            const email = document.getElementById('reg-user-email').value;
            const pass = document.getElementById('reg-user-pass').value;

            if(!name || !nick || !email || !pass) return alert("–í—Å—ñ –ø–æ–ª—è –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ!");
            
            const check_nick = await DB_LAYER.ref('users/' + nick).get();
            if(check_nick.exists()) return alert("–ù—ñ–∫–Ω–µ–π–º –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π!");

            app_state.otp_code = Math.floor(100000 + Math.random() * 900000).toString();
            emailjs.send('service_dbkrnz9', 'template_n90xvc9', {
                to_email: email,
                otp_code: app_state.otp_code
            }).then(() => {
                document.getElementById('auth-reg-box').classList.add('hidden');
                document.getElementById('reg-step-2').classList.remove('hidden');
            });
        }

        function finalizeRegistration() {
            if(document.getElementById('v-otp').value === app_state.otp_code) {
                const user_payload = {
                    name: document.getElementById('reg-full-name').value,
                    nick: document.getElementById('reg-user-nick').value.trim(),
                    email: document.getElementById('reg-user-email').value,
                    password: document.getElementById('reg-user-pass').value,
                    avatar: app_state.temp_avatar_buffer || "https://api.dicebear.com/7.x/bottts/svg?seed=" + Math.random(),
                    is_admin: document.getElementById('reg-user-email').value === SUPER_ADMIN,
                    created_at: Date.now()
                };
                DB_LAYER.ref('users/' + user_payload.nick).set(user_payload);
                localStorage.setItem('artem_user_v4', JSON.stringify(user_payload));
                location.reload();
            } else {
                alert("–ö–æ–¥ –Ω–µ–≤—ñ—Ä–Ω–∏–π!");
            }
        }

        // --- NAVIGATION & UI ---
        function navigate(target) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`page-${target}`).classList.remove('hidden');
            if(target === 'shop') initializeMarket();
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function systemSignOut() { localStorage.clear(); location.reload(); }

        // --- MARKET ENGINE ---
        function renderProduct(id, item) {
            return `
                <div class="premium-card p-8 animate-slide-up">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-[9px] bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 px-4 py-2 rounded-xl font-black uppercase">${item.game}</span>
                        <div class="w-2 h-2 bg-green-500 rounded-full shadow-[0_0_10px_green]"></div>
                    </div>
                    <img src="${item.img}" class="w-full h-56 object-cover rounded-[2.5rem] mb-6 shadow-2xl">
                    <h3 class="font-black text-xl text-white mb-3 truncate">${item.title}</h3>
                    <div class="flex items-center gap-3 mb-8">
                        <img src="${item.seller_avatar}" class="w-6 h-6 rounded-lg object-cover">
                        <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">@${item.seller_nick}</span>
                    </div>
                    <div class="flex justify-between items-center pt-6 border-t border-slate-900">
                        <span class="text-3xl font-black text-white">$${item.price}</span>
                        <button onclick="executeChatInitiation('${item.seller_nick}', '${item.seller_avatar}')" class="btn-neon px-8 py-4 text-[10px]">Chat</button>
                    </div>
                </div>
            `;
        }

        function initializeMarket() {
            DB_LAYER.ref('products').on('value', (snap) => {
                const grid = document.getElementById('product-grid');
                grid.innerHTML = '';
                const data = snap.val();
                if(data) {
                    Object.keys(data).reverse().forEach(id => {
                        grid.innerHTML += renderProduct(id, data[id]);
                    });
                }
            });
        }

        function filterMyProducts() {
            navigate('shop');
            const my_nick = app_state.current_user.nick;
            DB_LAYER.ref('products').once('value', (snap) => {
                const grid = document.getElementById('product-grid');
                grid.innerHTML = '';
                const data = snap.val();
                let has_items = false;
                if(data) {
                    Object.keys(data).forEach(id => {
                        if(data[id].seller_nick === my_nick) {
                            grid.innerHTML += renderProduct(id, data[id]);
                            has_items = true;
                        }
                    });
                }
                if(!has_items) grid.innerHTML = '<div class="col-span-full py-20 text-center font-black text-slate-700 uppercase tracking-widest">–í–∏ —â–µ –Ω–µ –≤–∏—Å—Ç–∞–≤–∏–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –ª–æ—Ç—É</div>';
            });
        }

        function submitProductToFirebase() {
            const file = document.getElementById('p-new-img').files[0];
            if(!file) return alert("–§–æ—Ç–æ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ!");

            const reader = new FileReader();
            reader.onload = () => {
                const new_ref = DB_LAYER.ref('products').push();
                new_ref.set({
                    game: document.getElementById('p-new-game').value,
                    title: document.getElementById('p-new-title').value,
                    price: document.getElementById('p-new-price').value,
                    desc: document.getElementById('p-new-desc').value,
                    img: reader.result,
                    seller_nick: app_state.current_user.nick,
                    seller_avatar: app_state.current_user.avatar,
                    seller_email: app_state.current_user.email,
                    timestamp: Date.now()
                }).then(() => {
                    alert("–£–°–ü–Ü–®–ù–û –û–ü–£–ë–õ–Ü–ö–û–í–ê–ù–û!");
                    navigate('shop');
                });
            };
            reader.readAsDataURL(file);
        }

        // --- CHAT SYSTEM ---
        function executeChatInitiation(nick, avatar) {
            if(nick === app_state.current_user.nick) return alert("–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ —Å–∞–º–æ–º—É —Å–æ–±—ñ!");
            app_state.active_chat_partner = { nick, avatar };
            document.getElementById('chat-partner-av').src = avatar;
            document.getElementById('chat-partner-nick').innerText = "@" + nick;
            document.getElementById('system-chat').classList.remove('hidden');
            
            const chat_id = [app_state.current_user.nick, nick].sort().join('_');
            DB_LAYER.ref('chats/' + chat_id).on('value', (snap) => {
                const container = document.getElementById('chat-messages-container');
                container.innerHTML = '';
                const messages = snap.val();
                if(messages) {
                    Object.values(messages).forEach(m => {
                        const is_me = m.sender === app_state.current_user.nick;
                        container.innerHTML += `
                            <div class="flex flex-col ${is_me ? 'items-end' : 'items-start'}">
                                <div class="p-5 ${is_me ? 'bubble-me' : 'bubble-them'} max-w-[85%] text-sm font-bold shadow-lg">
                                    ${m.text}
                                </div>
                            </div>
                        `;
                    });
                }
                container.scrollTop = container.scrollHeight;
            });
        }

        function processMessageSend() {
            const input = document.getElementById('chat-input-field');
            const text = input.value.trim();
            if(!text) return;

            const chat_id = [app_state.current_user.nick, app_state.active_chat_partner.nick].sort().join('_');
            DB_LAYER.ref('chats/' + chat_id).push({
                sender: app_state.current_user.nick,
                text: text,
                time: Date.now()
            });
            input.value = '';
        }

        // --- BOOT ---
        window.onload = () => {
            if(app_state.current_user) {
                document.getElementById('auth-system').classList.add('hidden');
                document.getElementById('user-p-avatar').src = app_state.current_user.avatar;
                document.getElementById('user-p-avatar').classList.remove('hidden');
                document.getElementById('p-view-avatar').src = app_state.current_user.avatar;
                document.getElementById('p-view-name').innerText = app_state.current_user.name;
                document.getElementById('p-view-nick').innerText = "@" + app_state.current_user.nick;
                
                if(app_state.current_user.is_admin) document.getElementById('nav-btn-admin').classList.remove('hidden');

                // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –º–æ—ó—Ö –ª–æ—Ç—ñ–≤
                DB_LAYER.ref('products').on('value', (snap) => {
                    const data = snap.val();
                    let count = 0;
                    if(data) {
                        Object.values(data).forEach(p => { if(p.seller_nick === app_state.current_user.nick) count++; });
                    }
                    document.getElementById('my-lots-count').innerText = count;
                });

                initializeMarket();
            }

            CATEGORIES_MASTER.forEach(name => {
                document.getElementById('categories').innerHTML += `<button class="bg-slate-900 border border-slate-800 px-8 py-4 rounded-2xl text-[10px] font-black uppercase text-slate-500 hover:text-cyan-400 hover:border-cyan-500 transition-all whitespace-nowrap">${name}</button>`;
                document.getElementById('p-new-game').innerHTML += `<option value="${name}">${name}</option>`;
            });
        };
    </script>
</body>
</html>
