<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTEM STORE | SUPREME EDITION 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;700;900&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

    <style>
        :root {
            --cyan: #00f2ff;
            --blue: #3b82f6;
            --dark: #020617;
            --card: #0f172a;
            --border: #1e293b;
        }

        /* Анімації для солідності */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); } 50% { box-shadow: 0 0 25px rgba(0, 242, 255, 0.5); } }
        
        .animate-fade { animation: fadeIn 0.5s ease-out forwards; }
        .cyber-glow { animation: glow 3s infinite; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--dark); color: #f1f5f9; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        .h-font { font-family: 'Orbitron', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(15px); border: 1px solid var(--border); }
        
        .cyber-input {
            background: #000 !important;
            border: 1px solid var(--border) !important;
            border-radius: 18px !important;
            padding: 16px 20px !important;
            color: #fff !important;
            width: 100%;
            outline: none;
            transition: 0.3s;
        }
        .cyber-input:focus { border-color: var(--cyan) !important; box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }

        .btn-main {
            background: var(--cyan);
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            padding: 18px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
            letter-spacing: 1px;
        }
        .btn-main:active { transform: scale(0.96); }

        .card-item {
            background: linear-gradient(145deg, #111827, #020617);
            border: 1px solid var(--border);
            border-radius: 30px;
            overflow: hidden;
            transition: 0.4s;
        }
        .card-item:hover { border-color: var(--cyan); transform: translateY(-8px); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-28">

    <div id="auth-layer" class="fixed inset-0 z-[9999] bg-slate-950 flex items-center justify-center p-5 overflow-y-auto">
        <div class="w-full max-w-md bg-slate-900 border border-slate-800 p-10 rounded-[3rem] shadow-2xl animate-fade">
            
            <div id="box-reg" class="space-y-6">
                <div class="text-center">
                    <h2 class="h-font text-3xl font-black italic text-white">ARTEM<span class="text-cyan-400">STORE</span></h2>
                    <p class="text-slate-500 text-[10px] font-bold uppercase tracking-widest mt-2">Create New Identity</p>
                </div>
                
                <div class="flex justify-center">
                    <input type="file" id="reg-file" class="hidden" accept="image/*">
                    <label for="reg-file" id="reg-preview" class="w-24 h-24 rounded-3xl border-2 border-dashed border-slate-800 flex items-center justify-center cursor-pointer hover:border-cyan-500 transition-all">
                        <span class="text-[9px] text-slate-600 font-black">PHOTO</span>
                    </label>
                </div>

                <div class="space-y-3">
                    <input type="text" id="reg-name" placeholder="Full Name" class="cyber-input text-sm">
                    <input type="text" id="reg-nick" placeholder="Username (English)" class="cyber-input text-sm">
                    <input type="email" id="reg-email" placeholder="Email Address" class="cyber-input text-sm">
                    <input type="password" id="reg-pass" placeholder="Create Password" class="cyber-input text-sm">
                </div>

                <button onclick="startVerification()" class="w-full btn-main">Register</button>
                <button onclick="switchAuth('login')" class="w-full text-slate-500 text-[10px] font-black uppercase tracking-widest">Sign In</button>
            </div>

            <div id="box-login" class="hidden space-y-6">
                <div class="text-center">
                    <h2 class="h-font text-3xl text-white italic">WELCOME<span class="text-cyan-400">BACK</span></h2>
                </div>
                <div class="space-y-4">
                    <input type="email" id="log-email" placeholder="Email" class="cyber-input">
                    <input type="password" id="log-pass" placeholder="Password" class="cyber-input">
                </div>
                <button onclick="loginUser()" class="w-full btn-main">Login</button>
                <div class="flex flex-col gap-3 text-center">
                    <button onclick="switchAuth('forgot')" class="text-cyan-500/60 text-[10px] font-black uppercase tracking-widest">Forgot Password?</button>
                    <button onclick="switchAuth('reg')" class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Create Account</button>
                </div>
            </div>

            <div id="box-forgot" class="hidden space-y-6">
                <div class="text-center">
                    <h2 class="h-font text-2xl text-white">RECOVER<span class="text-cyan-400">ACCESS</span></h2>
                    <p class="text-slate-500 text-[9px] font-bold uppercase mt-2">Ми надішлемо код для входу</p>
                </div>
                <input type="email" id="forgot-email" placeholder="Your Email" class="cyber-input">
                <button onclick="sendRecoveryOTP()" class="w-full btn-main">Send Code</button>
                <button onclick="switchAuth('login')" class="w-full text-slate-600 text-[10px] font-black uppercase">Back</button>
            </div>

            <div id="box-otp" class="hidden space-y-8 text-center">
                <h2 class="h-font text-xl text-cyan-400 uppercase">Verification</h2>
                <input type="text" id="otp-input" maxlength="6" class="w-full bg-black border-2 border-cyan-500 p-4 rounded-2xl text-center text-4xl font-black text-cyan-400 tracking-widest">
                <button id="otp-action-btn" class="w-full btn-main">Verify</button>
            </div>

        </div>
    </div>

    <header class="sticky top-0 z-[500] glass px-6 py-5 flex justify-between items-center">
        <div class="flex items-center gap-3" onclick="navigate('profile')">
            <img id="head-avatar" class="w-11 h-11 rounded-2xl border border-cyan-500/30 object-cover hidden">
            <div>
                <h1 class="h-font text-lg text-white font-black italic">ARTEM<span class="text-cyan-400">STORE</span></h1>
                <p class="text-[7px] text-slate-600 font-bold uppercase tracking-[0.3em]">Neural Link Stable</p>
            </div>
        </div>
        <button onclick="openChatList()" class="p-3.5 bg-slate-900 rounded-2xl border border-slate-800 relative">
            <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
        </button>
    </header>

    <main class="p-5 md:p-10 max-w-6xl mx-auto">
        <section id="page-shop" class="space-y-8">
            <div id="cat-list" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
            <div id="grid-market" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="page-add" class="hidden max-w-xl mx-auto space-y-8 animate-fade">
            <div class="bg-slate-900/50 p-8 rounded-[2.5rem] border border-slate-800 space-y-5">
                <h2 class="h-font text-xl text-center text-white italic">CREATE LISTING</h2>
                <select id="add-game" class="cyber-input text-xs font-bold uppercase"></select>
                <input type="text" id="add-title" placeholder="Title" class="cyber-input">
                <input type="number" id="add-price" placeholder="Price (USD)" class="cyber-input">
                <textarea id="add-desc" placeholder="Details..." class="cyber-input h-32"></textarea>
                <input type="file" id="add-file" class="hidden" accept="image/*">
                <label for="add-file" id="add-preview" class="w-full h-32 rounded-2xl border-2 border-dashed border-slate-800 flex items-center justify-center cursor-pointer text-slate-600 text-[10px] font-black">UPLOAD MEDIA</label>
                <button onclick="uploadProduct()" class="w-full btn-main">Publish</button>
            </div>
        </section>

        <section id="page-profile" class="hidden space-y-6 animate-fade">
            <div class="bg-gradient-to-br from-slate-900 to-slate-950 p-10 rounded-[3.5rem] border border-slate-800 text-center relative">
                <button onclick="logOut()" class="absolute top-6 right-6 text-red-500/40 hover:text-red-500 text-[9px] font-black uppercase">Exit</button>
                <img id="prof-avatar" class="w-32 h-32 rounded-[2.5rem] mx-auto object-cover border-4 border-slate-900 shadow-2xl mb-6">
                <h2 id="prof-name" class="h-font text-2xl text-white italic"></h2>
                <p id="prof-nick" class="mono text-cyan-400 text-xs tracking-widest mt-2"></p>
                
                <div class="grid grid-cols-2 gap-3 mt-10">
                    <div class="bg-black/30 p-5 rounded-3xl border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase">Active Lots</span>
                        <span id="prof-lots" class="text-xl font-black text-white">0</span>
                    </div>
                    <div class="bg-black/30 p-5 rounded-3xl border border-white/5">
                        <span class="block text-[8px] text-slate-600 font-black uppercase">Rating</span>
                        <span class="text-xl font-black text-amber-500">5.0</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <nav class="fixed bottom-0 inset-x-0 h-24 glass border-t border-white/5 flex justify-around items-center px-10 z-[1000]">
        <button onclick="navigate('shop')" class="text-cyan-400 flex flex-col items-center gap-1">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            <span class="text-[8px] font-black uppercase">Shop</span>
        </button>
        <button id="nav-add" onclick="navigate('add')" class="hidden text-slate-500 flex flex-col items-center gap-1">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            <span class="text-[8px] font-black uppercase">Sell</span>
        </button>
        <button onclick="navigate('profile')" class="text-slate-500 flex flex-col items-center gap-1">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            <span class="text-[8px] font-black uppercase">User</span>
        </button>
    </nav>
    <script>
        // --- CONFIG & DATABASE ---
        const DB_URL = "https://gameshop-ff113-default-rtdb.firebaseio.com/";
        const EJS_KEY = "KErbU8_xE37eaf0qi";
        firebase.initializeApp({ databaseURL: DB_URL });
        const DB = firebase.database();
        emailjs.init(EJS_KEY);

        const GAMES = ["Brawl Stars", "Standoff 2", "PUBG Mobile", "Roblox", "Steam", "Genshin Impact", "Free Fire", "Clash Royale"];
        const ADMIN_MAIL = "ilemberk3356@gmail.com";

        let state = {
            user: JSON.parse(localStorage.getItem('artem_user_v6')) || null,
            otp: null,
            temp_img: null,
            recovery_data: null
        };

        // --- AUTH LOGIC & FIXES ---
        function switchAuth(box) {
            ['box-reg', 'box-login', 'box-forgot', 'box-otp'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('box-' + box).classList.remove('hidden');
        }

        async function loginUser() {
            const email = document.getElementById('log-email').value.trim().toLowerCase();
            const pass = document.getElementById('log-pass').value.trim();

            if(!email || !pass) return alert("Заповніть всі поля!");

            const snap = await DB.ref('users').once('value');
            const users = snap.val();
            let found = null;

            if(users) {
                Object.values(users).forEach(u => {
                    if(u.email.toLowerCase() === email) found = u;
                });
            }

            if(!found) return alert("Користувача не знайдено!");

            // --- ЖОРСТКИЙ ФІКС ПАРОЛЯ ---
            if (!found.password) {
                found.password = "ilemberk3356";
                await DB.ref('users/' + found.nick).update({ password: "ilemberk3356" });
                alert("Ваш акаунт оновлено. Тимчасовий пароль: ilemberk3356");
            }

            if(found.password === pass) {
                localStorage.setItem('artem_user_v6', JSON.stringify(found));
                location.reload();
            } else {
                alert("Невірний пароль!");
            }
        }

        // --- ВІДНОВЛЕННЯ ЧЕРЕЗ КОД ---
        async function sendRecoveryOTP() {
            const email = document.getElementById('forgot-email').value.trim().toLowerCase();
            if(!email) return alert("Введіть Email!");

            const snap = await DB.ref('users').once('value');
            const users = snap.val();
            let userExists = false;
            if(users) Object.values(users).forEach(u => { if(u.email.toLowerCase() === email) userExists = true; });

            if(!userExists) return alert("Ця пошта не зареєстрована!");

            state.otp = Math.floor(100000 + Math.random() * 900000).toString();
            state.recovery_data = { email };

            emailjs.send('service_dbkrnz9', 'template_n90xvc9', {
                to_email: email,
                otp_code: state.otp
            }).then(() => {
                alert("Код надіслано!");
                switchAuth('otp');
                document.getElementById('otp-action-btn').innerText = "Authorize Access";
                document.getElementById('otp-action-btn').onclick = finalizeRecovery;
            });
        }

        async function finalizeRecovery() {
            const entered = document.getElementById('otp-input').value;
            if(entered !== state.otp) return alert("Код невірний!");

            const snap = await DB.ref('users').once('value');
            const users = snap.val();
            let userData = null;
            Object.values(users).forEach(u => { if(u.email.toLowerCase() === state.recovery_data.email) userData = u; });

            if(userData) {
                localStorage.setItem('artem_user_v6', JSON.stringify(userData));
                alert("Вхід успішний! Змініть пароль у профілі.");
                location.reload();
            }
        }

        // --- MARKET ENGINE ---
        function renderMarket() {
            DB.ref('products').on('value', snap => {
                const grid = document.getElementById('grid-market');
                grid.innerHTML = '';
                const data = snap.val();
                if(data) {
                    Object.keys(data).reverse().forEach(id => {
                        const p = data[id];
                        grid.innerHTML += `
                            <div class="card-item p-6 flex flex-col">
                                <img src="${p.img}" class="w-full h-44 object-cover rounded-2xl mb-4">
                                <div class="flex justify-between items-center mb-3">
                                    <span class="text-[8px] font-black text-cyan-400 uppercase border border-cyan-400/20 px-2 py-1 rounded-md">${p.game}</span>
                                    <span class="text-xl font-black text-white">$${p.price}</span>
                                </div>
                                <h3 class="text-white font-bold text-sm mb-4 truncate">${p.title}</h3>
                                <div class="flex items-center gap-2 mt-auto pt-4 border-t border-white/5">
                                    <img src="${p.seller_avatar}" class="w-6 h-6 rounded-full object-cover">
                                    <span class="text-[9px] text-slate-500 font-bold uppercase">@${p.seller_nick}</span>
                                </div>
                            </div>
                        `;
                    });
                }
            });
        }

        // --- NAVIGATION ---
        function navigate(page) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('page-' + page).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-cyan-400', 'text-slate-500'));
            event.currentTarget.classList.replace('text-slate-500', 'text-cyan-400');
        }

        function logOut() { localStorage.clear(); location.reload(); }

        // --- INITIALIZE ---
        window.onload = () => {
            if(state.user) {
                document.getElementById('auth-layer').classList.add('hidden');
                document.getElementById('head-avatar').src = state.user.avatar;
                document.getElementById('head-avatar').classList.remove('hidden');
                document.getElementById('prof-avatar').src = state.user.avatar;
                document.getElementById('prof-name').innerText = state.user.name;
                document.getElementById('prof-nick').innerText = "@" + state.user.nick;
                
                if(state.user.email === ADMIN_MAIL) document.getElementById('nav-add').classList.remove('hidden');

                renderMarket();
                
                // Категорії
                GAMES.forEach(g => {
                    document.getElementById('cat-list').innerHTML += `<button class="bg-slate-900 border border-slate-800 px-5 py-3 rounded-xl text-[10px] font-black text-slate-500 hover:text-cyan-400 transition-all whitespace-nowrap uppercase">${g}</button>`;
                    document.getElementById('add-game').innerHTML += `<option value="${g}">${g}</option>`;
                });
            }
        };

        // Реєстрація фото
        document.getElementById('reg-file').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = () => {
                state.temp_img = reader.result;
                document.getElementById('reg-preview').innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover rounded-3xl">`;
            };
            reader.readAsDataURL(e.target.files[0]);
        };
    </script>
</body>
</html>
