<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTEM STORE | GLOBAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --cyan: #00f2ff; --dark: #020617; }
        body { font-family: 'Inter', sans-serif; background: var(--dark); color: white; margin: 0; }
        .header-font { font-family: 'Orbitron', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .premium-card { background: linear-gradient(165deg, #111827, #020617); border: 1px solid #1f2937; transition: 0.3s; }
        .premium-card:hover { border-color: var(--cyan); transform: translateY(-5px); }
        .filter-btn.active { background: var(--cyan); color: black; box-shadow: 0 0 15px var(--cyan); }
        .msg-bubble { max-width: 80%; padding: 12px; border-radius: 15px; font-size: 14px; }
        .msg-mine { background: var(--cyan); color: black; align-self: flex-end; }
        .msg-theirs { background: #1f2937; align-self: flex-start; }
        .hidden { display: none !important; }
        .glass { background: rgba(2, 6, 23, 0.95); backdrop-blur: 10px; }
    </style>
</head>
<body class="pb-20">
    <div id="auth-layer" class="fixed inset-0 z-[2000] bg-slate-950 flex items-center justify-center p-6">
        <div class="w-full max-w-md space-y-6 bg-slate-900 p-8 rounded-[2.5rem] border border-slate-800">
            <div id="auth-step-1" class="space-y-4">
                <div class="text-center"><h2 class="header-font text-2xl text-cyan-400">IDENTITY</h2></div>
                <div class="flex justify-center">
                    <input type="file" id="reg-avatar-input" class="hidden" accept="image/*">
                    <label for="reg-avatar-input" class="cursor-pointer">
                        <div id="avatar-circle" class="w-24 h-24 rounded-full border-2 border-dashed border-slate-700 flex items-center justify-center overflow-hidden bg-black">
                            <span class="text-[8px] text-slate-500 uppercase font-black">Add Photo</span>
                        </div>
                    </label>
                </div>
                <input type="text" id="reg-name" placeholder="Full Name" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none">
                <input type="text" id="reg-nick" placeholder="@username" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none">
                <input type="email" id="reg-email" placeholder="Email" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none">
                <button onclick="handleAuthNext()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl uppercase">Request Code</button>
            </div>
            <div id="auth-step-2" class="hidden space-y-4">
                <p class="text-center text-xs text-slate-400">Attempts: <span id="auth-limit">12</span></p>
                <input type="text" id="auth-code-input" placeholder="000000" class="w-full bg-black border-2 border-cyan-500 p-4 rounded-xl text-center text-2xl font-black text-cyan-400 tracking-widest">
                <button onclick="verifyAndLogin()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl">VERIFY</button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-[1000] glass border-b border-slate-800 p-4 flex justify-between items-center">
        <div class="flex items-center gap-3" onclick="navigateTo('profile')">
            <img id="top-avatar-img" src="" class="w-10 h-10 rounded-full border border-cyan-500 hidden object-cover">
            <h1 class="header-font text-lg font-black italic">ARTEM<span class="text-cyan-400">STORE</span></h1>
        </div>
        <div class="relative" onclick="openInbox()">
            <span class="text-2xl">üîî</span>
            <div id="inbox-alert" class="hidden absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
        </div>
    </header>

    <main id="main-content">
        <section id="view-shop" class="p-4 space-y-4">
            <div class="flex gap-2 overflow-x-auto no-scrollbar" id="filter-games"></div>
            <div class="flex gap-2" id="filter-cats"></div>
            <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

        <section id="view-admin" class="hidden p-6 space-y-4">
            <h2 class="header-font text-cyan-400">NEW LISTING</h2>
            <div class="space-y-3 bg-slate-900 p-5 rounded-3xl">
                <select id="new-game" class="w-full bg-black p-4 rounded-xl border border-slate-800"></select>
                <select id="new-cat" class="w-full bg-black p-4 rounded-xl border border-slate-800">
                    <option>Accounts</option><option>Currency</option><option>Boost</option>
                </select>
                <input type="text" id="new-title" placeholder="Title" class="w-full bg-black p-4 rounded-xl">
                <input type="number" id="new-price" placeholder="Price ($)" class="w-full bg-black p-4 rounded-xl">
                <textarea id="new-desc" placeholder="Description" class="w-full bg-black p-4 rounded-xl h-24"></textarea>
                <input type="file" id="new-img" class="hidden" accept="image/*">
                <label for="new-img" class="block p-4 border-2 border-dashed border-slate-800 rounded-xl text-center text-xs text-slate-500">UPLOAD IMAGE</label>
                <button onclick="commitNewProduct()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl">PUBLISH</button>
            </div>
        </section>

        <section id="view-profile" class="hidden p-8 text-center space-y-6">
            <img id="p-avatar" class="w-32 h-32 rounded-full border-4 border-cyan-500 mx-auto object-cover">
            <h2 id="p-name" class="header-font text-2xl"></h2>
            <p id="p-nick" class="text-cyan-400 font-mono"></p>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-900 p-4 rounded-2xl"><p class="text-[8px] text-slate-500">SALES</p><p id="p-sales" class="text-xl font-black">0</p></div>
                <div class="bg-slate-900 p-4 rounded-2xl"><p class="text-[8px] text-slate-500">BOUGHT</p><p id="p-bought" class="text-xl font-black">0</p></div>
            </div>
            <div class="bg-slate-900 p-6 rounded-3xl">
                <div class="flex justify-center gap-1 text-yellow-500 text-xl" id="p-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <p class="text-[8px] text-slate-600 mt-2 uppercase">Verified by Artem Store Security</p>
            </div>
            <button onclick="userLogout()" class="text-red-500 text-[10px] font-black uppercase">Logout</button>
        </section>
    </main>
    <section id="chat-window" class="hidden fixed inset-0 z-[1500] bg-slate-950 flex flex-col">
        <div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900">
            <div class="flex items-center gap-3">
                <img id="c-partner-img" class="w-10 h-10 rounded-full object-cover">
                <div><p id="c-partner-name" class="font-bold text-sm"></p><p id="c-partner-nick" class="text-[10px] text-cyan-500"></p></div>
            </div>
            <button onclick="exitChat()" class="text-2xl">&times;</button>
        </div>
        <div id="c-messages-area" class="flex-1 overflow-y-auto p-4 flex flex-col gap-3"></div>
        <div class="p-4 bg-slate-900 flex gap-2">
            <input type="text" id="chat-input" placeholder="Message..." class="flex-1 bg-black p-3 rounded-xl outline-none">
            <button onclick="dispatchMessage()" class="bg-cyan-500 text-black px-6 rounded-xl font-black text-xs">SEND</button>
        </div>
    </section>

    <div id="inbox-layer" class="hidden fixed inset-0 z-[1100] glass p-6">
        <div class="max-w-md mx-auto bg-slate-900 rounded-[2rem] h-[80vh] flex flex-col">
            <div class="p-5 border-b border-slate-800 flex justify-between"><span>INBOX</span><button onclick="closeInbox()">Close</button></div>
            <div id="inbox-list" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
        </div>
    </div>

    <div id="rate-layer" class="hidden fixed inset-0 z-[3000] glass flex items-center justify-center p-6">
        <div class="bg-slate-900 border border-cyan-500 p-10 rounded-[2rem] text-center w-full max-w-sm">
            <h2 class="header-font text-cyan-400 mb-4">RATE SELLER</h2>
            <div class="flex justify-center gap-2 text-3xl mb-8" id="star-selector">
                <span onclick="setR(1)">‚òÖ</span><span onclick="setR(2)">‚òÖ</span><span onclick="setR(3)">‚òÖ</span><span onclick="setR(4)">‚òÖ</span><span onclick="setR(5)">‚òÖ</span>
            </div>
            <button onclick="location.reload()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl">FINALIZE</button>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-slate-950 border-t border-slate-800 p-4 flex justify-around z-[1000]">
        <button onclick="navigateTo('shop')" class="text-cyan-400 flex flex-col items-center" id="btn-shop"><span class="text-xl">üõí</span><span class="text-[7px]">MARKET</span></button>
        <button onclick="navigateTo('admin')" class="text-slate-500 flex flex-col items-center hidden" id="btn-admin"><span class="text-xl">‚ûï</span><span class="text-[7px]">CREATE</span></button>
        <button onclick="navigateTo('profile')" class="text-slate-500 flex flex-col items-center" id="btn-profile"><span class="text-xl">üë§</span><span class="text-[7px]">ME</span></button>
    </nav>

    <script>
        const ADMIN_G = "ilemberk3356@gmail.com";
        const GAMES = ["Brawl Stars", "Standoff 2", "PUBG Mobile", "Roblox", "Valorant", "Genshin", "CS 2", "FIFA", "Minecraft", "Steam"];
        let state = {
            user: JSON.parse(localStorage.getItem('as_user')) || null,
            db: JSON.parse(localStorage.getItem('as_db')) || [],
            msgs: JSON.parse(localStorage.getItem('as_msgs')) || [],
            activeGame: "All Games", activeCat: "Accounts", vCode: null, limit: 12, tempAv: null, curP: null
        };

        document.getElementById('reg-avatar-input').onchange = (e) => {
            const r = new FileReader();
            r.onload = () => { state.tempAv = r.result; document.getElementById('avatar-circle').innerHTML = `<img src="${r.result}" class="w-full h-full object-cover">`; };
            r.readAsDataURL(e.target.files[0]);
        };

        function handleAuthNext() {
            const email = document.getElementById('reg-email').value;
            if(!email.includes('@')) return alert("Invalid Email");
            state.vCode = Math.floor(100000 + Math.random() * 900000).toString();
            emailjs.send('service_dbkrnz9', 'template_n90xvc9', {to_email: email, user_name: document.getElementById('reg-name').value, otp_code: state.vCode}, 'KErbU8_xE37eaf0qi')
                .then(() => { alert("Code sent to " + email); document.getElementById('auth-step-1').classList.add('hidden'); document.getElementById('auth-step-2').classList.remove('hidden'); });
        }

        function verifyAndLogin() {
            if(document.getElementById('auth-code-input').value === state.vCode) {
                state.user = { name: document.getElementById('reg-name').value, nick: document.getElementById('reg-nick').value, email: document.getElementById('reg-email').value, avatar: state.tempAv || "", isAdmin: document.getElementById('reg-email').value === ADMIN_G, stats: { sales: 0, bought: 0 } };
                localStorage.setItem('as_user', JSON.stringify(state.user)); location.reload();
            } else { state.limit--; document.getElementById('auth-limit').innerText = state.limit; if(state.limit <= 0) location.reload(); }
        }

        function navigateTo(v) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`view-${v}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-cyan-400', 'text-slate-500'));
            event.currentTarget.classList.replace('text-slate-500', 'text-cyan-400');
        }

        function renderProducts() {
            const grid = document.getElementById('products-list'); grid.innerHTML = '';
            state.db.filter(p => (state.activeGame === "All Games" || p.game === state.activeGame) && p.cat === state.activeCat).forEach(p => {
                grid.innerHTML += `<div class="premium-card rounded-3xl p-5"><div class="flex justify-between mb-3 text-[10px] text-cyan-400"><span>${p.game}</span><span>${p.seller.nick}</span></div><img src="${p.img}" class="w-full h-40 object-cover rounded-2xl mb-3"><h3 class="font-black truncate">${p.title}</h3><div class="flex justify-between items-center mt-4"><span class="text-xl font-black">$${p.price}</span><div class="flex gap-2"><button onclick="startInquiry('${p.seller.nick}','${p.seller.avatar}','${p.seller.name}')" class="bg-slate-800 p-3 rounded-xl">üí¨</button><button onclick="buy()" class="bg-cyan-500 text-black px-4 py-2 rounded-xl font-black text-xs">BUY</button></div></div></div>`;
            });
        }

        function startInquiry(nick, av, name) {
            if(nick === state.user.nick) return;
            state.curP = { nick, av, name };
            document.getElementById('c-partner-img').src = av;
            document.getElementById('c-partner-name').innerText = name;
            document.getElementById('c-partner-nick').innerText = nick;
            document.getElementById('chat-window').classList.remove('hidden'); renderMsgs();
        }

        function dispatchMessage() {
            const inp = document.getElementById('chat-input'); if(!inp.value) return;
            state.msgs.push({ sender: state.user.nick, receiver: state.curP.nick, text: inp.value, time: Date.now() });
            localStorage.setItem('as_msgs', JSON.stringify(state.msgs)); inp.value = ''; renderMsgs();
        }

        function renderMsgs() {
            const area = document.getElementById('c-messages-area'); area.innerHTML = '';
            state.msgs.filter(m => (m.sender === state.user.nick && m.receiver === state.curP.nick) || (m.sender === state.curP.nick && m.receiver === state.user.nick)).forEach(m => {
                area.innerHTML += `<div class="msg-bubble ${m.sender === state.user.nick ? 'msg-mine' : 'msg-theirs'}">${m.text}</div>`;
            });
            area.scrollTop = area.scrollHeight;
        }

        function openInbox() {
            document.getElementById('inbox-layer').classList.remove('hidden');
            const list = document.getElementById('inbox-list'); list.innerHTML = '';
            [...new Set(state.msgs.map(m => m.sender === state.user.nick ? m.receiver : m.sender))].forEach(p => {
                list.innerHTML += `<div onclick="startInquiry('${p}','','User')" class="p-4 bg-black rounded-2xl border border-slate-800">@${p}</div>`;
            });
        }

        function commitNewProduct() {
            const f = document.getElementById('new-img').files[0];
            const r = new FileReader();
            r.onload = () => {
                state.db.unshift({ id: Date.now(), game: document.getElementById('new-game').value, cat: document.getElementById('new-cat').value, title: document.getElementById('new-title').value, price: document.getElementById('new-price').value, desc: document.getElementById('new-desc').value, img: r.result, seller: { name: state.user.name, nick: state.user.nick, avatar: state.user.avatar } });
                localStorage.setItem('as_db', JSON.stringify(state.db)); location.reload();
            };
            r.readAsDataURL(f);
        }

        function buy() { state.user.stats.bought++; localStorage.setItem('as_user', JSON.stringify(state.user)); document.getElementById('rate-layer').classList.remove('hidden'); }
        function exitChat() { document.getElementById('chat-window').classList.add('hidden'); }
        function closeInbox() { document.getElementById('inbox-layer').classList.add('hidden'); }
        function userLogout() { localStorage.clear(); location.reload(); }
        function setFilterG(g) { state.activeGame = g; renderProducts(); }
        function setFilterC(c) { state.activeCat = c; renderProducts(); }

        window.onload = () => {
            if(state.user) {
                document.getElementById('auth-layer').classList.add('hidden');
                document.getElementById('top-avatar-img').src = state.user.avatar; document.getElementById('top-avatar-img').classList.remove('hidden');
                document.getElementById('p-avatar').src = state.user.avatar; document.getElementById('p-name').innerText = state.user.name;
                document.getElementById('p-nick').innerText = state.user.nick; document.getElementById('p-bought').innerText = state.user.stats.bought;
                if(state.user.isAdmin) document.getElementById('btn-admin').classList.remove('hidden');
            }
            const gBox = document.getElementById('filter-games');
            GAMES.forEach(g => gBox.innerHTML += `<button onclick="setFilterG('${g}')" class="bg-slate-900 px-4 py-2 rounded-xl text-[10px] whitespace-nowrap">${g}</button>`);
            const cBox = document.getElementById('filter-cats');
            ["Accounts", "Currency", "Boost"].forEach(c => cBox.innerHTML += `<button onclick="setFilterC('${c}')" class="flex-1 bg-slate-900 py-3 rounded-xl text-[10px]">${c}</button>`);
            GAMES.forEach(g => document.getElementById('new-game').innerHTML += `<option>${g}</option>`);
            renderProducts();
        };
    </script>
</body>
</html>
