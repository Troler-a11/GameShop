<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARTEM STORE | GLOBAL MARKETPLACE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --cyan: #00f2ff;
            --blue: #3b82f6;
            --dark: #020617;
            --card: #0f172a;
            --border: #1e293b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark);
            color: white;
            margin: 0;
            overflow-x: hidden;
        }

        .header-font { font-family: 'Orbitron', sans-serif; }

        /* –°—Ç–∏–ª—å–Ω—ñ –∫–∞—Ä—Ç–∫–∏ */
        .premium-card {
            background: linear-gradient(165deg, #111827, #020617);
            border: 1px solid var(--border);
            border-radius: 24px;
            transition: all 0.4s ease;
        }
        .premium-card:hover {
            border-color: var(--cyan);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.15);
            transform: translateY(-5px);
        }

        /* –ß–∞—Ç-–±—É–ª—å–±–∞—à–∫–∏ */
        .msg-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .msg-mine {
            background: var(--cyan);
            color: black;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .msg-theirs {
            background: #1e293b;
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .hidden { display: none !important; }
        .glass { background: rgba(2, 6, 23, 0.8); backdrop-blur: 15px; }
        
        /* –°–∫—Ä–æ–ª–ª */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body class="pb-24">

    <div id="auth-layer" class="fixed inset-0 z-[9999] bg-slate-950 flex items-center justify-center p-6">
        <div class="w-full max-w-md bg-slate-900 border border-slate-800 p-8 rounded-[3rem] shadow-2xl">
            
            <div id="auth-step-1" class="space-y-6">
                <div class="text-center">
                    <h2 class="header-font text-2xl text-cyan-400">IDENTITY</h2>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest mt-2">Global Access Portal</p>
                </div>

                <div class="flex flex-col items-center">
                    <input type="file" id="reg-avatar-input" class="hidden" accept="image/*">
                    <label for="reg-avatar-input" class="cursor-pointer">
                        <div id="avatar-preview" class="w-24 h-24 rounded-full border-2 border-dashed border-slate-700 flex items-center justify-center bg-black overflow-hidden">
                            <span class="text-[8px] text-slate-500 font-black">ADD PHOTO</span>
                        </div>
                    </label>
                </div>

                <div class="space-y-3">
                    <input type="text" id="reg-name" placeholder="Full Name" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none focus:border-cyan-500 transition-all">
                    <input type="text" id="reg-nick" placeholder="@username" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none focus:border-cyan-500 transition-all">
                    <input type="email" id="reg-email" placeholder="Email" class="w-full bg-black border border-slate-800 p-4 rounded-xl outline-none focus:border-cyan-500 transition-all">
                </div>

                <button onclick="sendVerificationEmail()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl uppercase tracking-widest hover:bg-cyan-400 transition-all">
                    Request Verification
                </button>
            </div>

            <div id="auth-step-2" class="hidden space-y-6">
                <div class="text-center">
                    <h2 class="header-font text-2xl text-white">VERIFY</h2>
                    <p class="text-slate-400 text-xs mt-2">–ö–æ–¥ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ –≤–∞—à—É –ø–æ—à—Ç—É</p>
                </div>

                <input type="text" id="auth-code-input" placeholder="000000" maxlength="6" class="w-full bg-black border-2 border-cyan-500 p-5 rounded-xl text-center text-3xl font-black text-cyan-400 tracking-[0.3em] outline-none">
                
                <p class="text-center text-[10px] text-red-500 font-bold uppercase">Attempts: <span id="retry-count">12</span></p>

                <button onclick="checkAuthCode()" class="w-full bg-white text-black font-black py-4 rounded-xl uppercase tracking-widest">
                    Confirm Access
                </button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-[100] glass border-b border-slate-800 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3" onclick="showSection('profile')">
            <img id="head-avatar" src="" class="w-10 h-10 rounded-full border border-cyan-500 hidden object-cover">
            <h1 class="header-font text-xl font-black italic">ARTEM<span class="text-cyan-400">STORE</span></h1>
        </div>
        <button onclick="openInbox()" class="text-2xl relative">
            üîî
            <div id="msg-dot" class="hidden absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-slate-950"></div>
        </button>
    </header>

    <main class="p-4 max-w-4xl mx-auto">
        
        <section id="sec-shop" class="space-y-6">
            <div id="filters" class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                </div>
            <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                </div>
        </section>

        <section id="sec-admin" class="hidden space-y-6">
            <h2 class="header-font text-2xl text-cyan-400">NEW LISTING</h2>
            <div class="bg-slate-900 p-6 rounded-[2rem] border border-slate-800 space-y-4">
                <select id="new-g" class="w-full bg-black p-4 rounded-xl border border-slate-800"></select>
                <input type="text" id="new-t" placeholder="Title" class="w-full bg-black p-4 rounded-xl">
                <input type="number" id="new-p" placeholder="Price ($)" class="w-full bg-black p-4 rounded-xl">
                <textarea id="new-d" placeholder="Description" class="w-full bg-black p-4 rounded-xl h-24"></textarea>
                <input type="file" id="new-img-input" class="hidden" accept="image/*">
                <label for="new-img-input" class="block p-8 border-2 border-dashed border-slate-800 rounded-xl text-center text-slate-500 cursor-pointer">UPLOAD IMAGE</label>
                <button onclick="createNewProduct()" class="w-full bg-cyan-500 text-black font-black py-4 rounded-xl">PUBLISH</button>
            </div>
        </section>

        <section id="sec-profile" class="hidden text-center space-y-8">
            <div class="relative inline-block">
                <img id="p-av" class="w-32 h-32 rounded-full border-4 border-cyan-500 mx-auto object-cover">
                <div class="absolute bottom-0 right-0 bg-cyan-500 text-black p-2 rounded-full text-xs font-black">‚úì</div>
            </div>
            <div>
                <h2 id="p-name" class="header-font text-3xl font-black"></h2>
                <p id="p-nick" class="text-cyan-400 font-mono"></p>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-900 p-6 rounded-3xl"><p class="text-xs text-slate-500">SALES</p><p id="st-s" class="text-2xl font-black">0</p></div>
                <div class="bg-slate-900 p-6 rounded-3xl"><p class="text-xs text-slate-500">BOUGHT</p><p id="st-b" class="text-2xl font-black">0</p></div>
            </div>
            <button onclick="logout()" class="text-red-500 font-black text-xs tracking-widest">LOGOUT</button>
        </section>

    </main>

    <div id="chat-box" class="hidden fixed inset-0 z-[5000] bg-slate-950 flex flex-col">
        <div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900">
            <div class="flex items-center gap-3">
                <img id="chat-av" class="w-10 h-10 rounded-full object-cover">
                <span id="chat-nick" class="font-bold"></span>
            </div>
            <button onclick="closeChat()" class="text-3xl">&times;</button>
        </div>
        <div id="chat-msgs" class="flex-1 overflow-y-auto p-4 flex flex-col"></div>
        <div class="p-4 bg-slate-900 flex gap-2">
            <input type="text" id="m-input" placeholder="Message..." class="flex-1 bg-black p-4 rounded-xl outline-none">
            <button onclick="sendChatMessage()" class="bg-cyan-500 text-black px-6 rounded-xl font-black">SEND</button>
        </div>
    </div>

    <div id="inbox-box" class="hidden fixed inset-0 z-[4000] glass flex items-center justify-center p-6">
        <div class="w-full max-w-md bg-slate-900 rounded-[3rem] h-[70vh] flex flex-col border border-slate-800">
            <div class="p-6 border-b border-slate-800 flex justify-between items-center">
                <span class="header-font text-cyan-400">INBOX</span>
                <button onclick="closeInbox()" class="text-xs font-black">CLOSE</button>
            </div>
            <div id="inbox-list" class="flex-1 overflow-y-auto p-4 space-y-2"></div>
        </div>
    </div>

    <nav class="fixed bottom-0 inset-x-0 h-20 glass border-t border-slate-800 flex justify-around items-center z-[500]">
        <button onclick="showSection('shop')" id="btn-shop" class="text-cyan-400 flex flex-col items-center">
            <span class="text-2xl">üõí</span><span class="text-[8px] font-black uppercase">Market</span>
        </button>
        <button onclick="showSection('admin')" id="btn-admin" class="text-slate-500 flex flex-col items-center hidden">
            <span class="text-2xl">‚ûï</span><span class="text-[8px] font-black uppercase">Create</span>
        </button>
        <button onclick="showSection('profile')" id="btn-profile" class="text-slate-500 flex flex-col items-center">
            <span class="text-2xl">üë§</span><span class="text-[8px] font-black uppercase">Me</span>
        </button>
    </nav>

    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è EmailJS (—Ç–≤—ñ–π Public Key)
        emailjs.init("KErbU8_xE37eaf0qi");

        const ADMIN_EMAIL = "ilemberk3356@gmail.com";
        const GAMES = ["Brawl Stars", "Standoff 2", "PUBG Mobile", "Roblox", "Steam", "Genshin", "Minecraft"];

        let app = {
            user: JSON.parse(localStorage.getItem('as_user')) || null,
            db: JSON.parse(localStorage.getItem('as_db')) || [],
            messages: JSON.parse(localStorage.getItem('as_ms')) || [],
            vCode: null,
            retries: 12,
            tempAv: null,
            chatPartner: null
        };

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞
        document.getElementById('reg-avatar-input').onchange = (e) => {
            const r = new FileReader();
            r.onload = () => {
                app.tempAv = r.result;
                document.getElementById('avatar-preview').innerHTML = `<img src="${r.result}" class="w-full h-full object-cover">`;
            };
            r.readAsDataURL(e.target.files[0]);
        };

        // –í–Ü–î–ü–†–ê–í–ö–ê –ö–û–î–£ (–í–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞)
        function sendVerificationEmail() {
            const email = document.getElementById('reg-email').value;
            const name = document.getElementById('reg-name').value;
            
            if(!email.includes('@')) return alert("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π Email!");

            app.vCode = Math.floor(100000 + Math.random() * 900000).toString();

            // –¢–≤—ñ–π Service ID —Ç–∞ Template ID
            emailjs.send('service_dbkrnz9', 'template_n90xvc9', {
                to_email: email,
                user_name: name,
                otp_code: app.vCode
            }).then(() => {
                alert("–ö–æ–¥ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!");
                document.getElementById('auth-step-1').classList.add('hidden');
                document.getElementById('auth-step-2').classList.remove('hidden');
            }).catch(err => alert("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏: " + err));
        }

        // –ü–ï–†–ï–í–Ü–†–ö–ê –ö–û–î–£
        function checkAuthCode() {
            const val = document.getElementById('auth-code-input').value;
            if(val === app.vCode) {
                app.user = {
                    name: document.getElementById('reg-name').value,
                    nick: document.getElementById('reg-nick').value,
                    email: document.getElementById('reg-email').value,
                    avatar: app.tempAv || "https://api.dicebear.com/7.x/bottts/svg",
                    isAdmin: document.getElementById('reg-email').value === ADMIN_EMAIL,
                    stats: { s: 0, b: 0 }
                };
                localStorage.setItem('as_user', JSON.stringify(app.user));
                location.reload();
            } else {
                app.retries--;
                document.getElementById('retry-count').innerText = app.retries;
                if(app.retries <= 0) location.reload();
            }
        }

        // –ù–ê–í–Ü–ì–ê–¶–Ü–Ø
        function showSection(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`sec-${id}`).classList.remove('hidden');
            
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-cyan-400', 'text-slate-500'));
            document.getElementById(`btn-${id}`).classList.replace('text-slate-500', 'text-cyan-400');
        }

        // –†–ï–ù–î–ï–† –¢–û–í–ê–†–Ü–í
        function renderItems() {
            const list = document.getElementById('products-list');
            list.innerHTML = '';
            app.db.forEach(p => {
                list.innerHTML += `
                    <div class="premium-card p-5">
                        <div class="flex justify-between text-[10px] mb-3 text-cyan-400 font-bold uppercase">
                            <span>${p.game}</span>
                            <span>${p.seller.nick}</span>
                        </div>
                        <img src="${p.img}" class="w-full h-40 object-cover rounded-2xl mb-4 bg-black">
                        <h3 class="font-black text-lg">${p.title}</h3>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-2xl font-black">$${p.price}</span>
                            <div class="flex gap-2">
                                <button onclick="openChat('${p.seller.nick}','${p.seller.avatar}')" class="bg-slate-800 p-3 rounded-xl">üí¨</button>
                                <button onclick="buyNow()" class="bg-cyan-500 text-black px-6 py-2 rounded-xl font-black text-xs uppercase">Buy</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // –ß–ê–¢ –õ–û–ì–Ü–ö–ê
        function openChat(nick, av) {
            if(nick === app.user.nick) return;
            app.chatPartner = { nick, av };
            document.getElementById('chat-av').src = av;
            document.getElementById('chat-nick').innerText = nick;
            document.getElementById('chat-box').classList.remove('hidden');
            renderMessages();
        }

        function sendChatMessage() {
            const inp = document.getElementById('m-input');
            if(!inp.value) return;
            app.messages.push({ f: app.user.nick, t: app.chatPartner.nick, txt: inp.value });
            localStorage.setItem('as_ms', JSON.stringify(app.messages));
            inp.value = '';
            renderMessages();
        }

        function renderMessages() {
            const area = document.getElementById('chat-msgs');
            area.innerHTML = '';
            app.messages.filter(m => 
                (m.f === app.user.nick && m.t === app.chatPartner.nick) || 
                (m.t === app.user.nick && m.f === app.chatPartner.nick)
            ).forEach(m => {
                area.innerHTML += `<div class="msg-bubble ${m.f === app.user.nick ? 'msg-mine' : 'msg-theirs'}">${m.txt}</div>`;
            });
            area.scrollTop = area.scrollHeight;
        }

        // –ê–î–ú–Ü–ù–ö–ê
        function createNewProduct() {
            const file = document.getElementById('new-img-input').files[0];
            const r = new FileReader();
            r.onload = () => {
                app.db.unshift({
                    game: document.getElementById('new-g').value,
                    title: document.getElementById('new-t').value,
                    price: document.getElementById('new-p').value,
                    img: r.result,
                    seller: { nick: app.user.nick, avatar: app.user.avatar }
                });
                localStorage.setItem('as_db', JSON.stringify(app.db));
                location.reload();
            };
            r.readAsDataURL(file);
        }

        function buyNow() {
            app.user.stats.b++;
            localStorage.setItem('as_user', JSON.stringify(app.user));
            alert("–ü–æ–∫—É–ø–∫–∞ —É—Å–ø—ñ—à–Ω–∞! –ó–≤'—è–∂—ñ—Ç—å—Å—è –∑ –ø—Ä–æ–¥–∞–≤—Ü–µ–º —É —á–∞—Ç—ñ.");
            location.reload();
        }

        function openInbox() {
            document.getElementById('inbox-box').classList.remove('hidden');
            const list = document.getElementById('inbox-list');
            list.innerHTML = '';
            const chats = [...new Set(app.messages.map(m => m.f === app.user.nick ? m.t : m.f))];
            chats.forEach(c => {
                list.innerHTML += `<div onclick="openChat('${c}', 'https://api.dicebear.com/7.x/bottts/svg')" class="p-4 bg-black border border-slate-800 rounded-2xl cursor-pointer">@${c}</div>`;
            });
        }

        function closeChat() { document.getElementById('chat-box').classList.add('hidden'); }
        function closeInbox() { document.getElementById('inbox-box').classList.add('hidden'); }
        function logout() { localStorage.clear(); location.reload(); }

        // –ó–ê–ü–£–°–ö
        window.onload = () => {
            if(app.user) {
                document.getElementById('auth-layer').classList.add('hidden');
                document.getElementById('head-avatar').src = app.user.avatar;
                document.getElementById('head-avatar').classList.remove('hidden');
                document.getElementById('p-av').src = app.user.avatar;
                document.getElementById('p-name').innerText = app.user.name;
                document.getElementById('p-nick').innerText = app.user.nick;
                document.getElementById('st-b').innerText = app.user.stats.b;
                if(app.user.isAdmin) document.getElementById('btn-admin').classList.remove('hidden');
            }
            GAMES.forEach(g => {
                document.getElementById('filters').innerHTML += `<button class="bg-slate-900 px-6 py-2 rounded-full text-[10px] whitespace-nowrap font-bold">${g}</button>`;
                document.getElementById('new-g').innerHTML += `<option>${g}</option>`;
            });
            renderItems();
        };
    </script>
</body>
</html>
